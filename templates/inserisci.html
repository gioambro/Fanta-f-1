<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Inserisci Risultati</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script>
  function toggleSprint(selectElement) {
    let sprintDiv = selectElement.closest(".pilota-form").querySelector(".sprint_pos_div");
    sprintDiv.style.display = (selectElement.value === "si") ? "block" : "none";
  }

  function enforceUniqueBonus(className, message) {
    let checkboxes = document.querySelectorAll("." + className);
    checkboxes.forEach(cb => {
      cb.addEventListener("change", function() {
        if (this.checked) {
          checkboxes.forEach(other => {
            if (other !== this) other.checked = false;
          });
          alert(message);
        }
      });
    });
  }

  window.onload = function() {
    enforceUniqueBonus("driver_day", "⚠️ Driver of the Day può essere assegnato a un solo pilota.");
    enforceUniqueBonus("fastest_lap", "⚠️ Il giro veloce può essere assegnato a un solo pilota.");
    enforceUniqueBonus("fastest_pit", "⚠️ Il fastest pit-stop può essere assegnato a un solo pilota.");
    enforceUniqueBonus("last_place", "⚠️ L'ultimo in gara può essere assegnato a un solo pilota.");
  };
  </script>
</head>
<body>
  <div class="container">
    <h1>Inserisci risultati</h1>
    <form action="/salva" method="post">

      <!-- Due piloti per ciascun giocatore -->
      {% for i in range(1, 3) %}
      <div class="pilota-form">
        <h2>Pilota {{ i }}</h2>

        <label>Giocatore:</label>
        <input type="text" name="giocatore{{ i }}" required><br><br>

        <label>Pilota:</label>
        <input type="text" name="pilota{{ i }}" required><br><br>

        <label>Griglia di partenza:</label>
        <input type="number" name="griglia{{ i }}" min="1" max="20"><br><br>

        <label>Posizione finale:</label>
        <input type="number" name="posizione{{ i }}" min="1" max="20"><br><br>

        <!-- Sprint -->
        <label>Gara Sprint?</label>
        <select name="sprint{{ i }}" onchange="toggleSprint(this)">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select>
        <br>

        <div class="sprint_pos_div" style="display:none;">
          <label>Posizione Sprint:</label>
          <select name="sprint_pos{{ i }}">
            <option value="">-- Seleziona --</option>
            <option value="1">1 (8 pt)</option>
            <option value="2">2 (7 pt)</option>
            <option value="3">3 (6 pt)</option>
            <option value="4">4 (5 pt)</option>
            <option value="5">5 (4 pt)</option>
            <option value="6">6 (3 pt)</option>
            <option value="7">7 (2 pt)</option>
            <option value="8">8 (1 pt)</option>
          </select>
        </div>
        <br><hr>

        <h3>Bonus</h3>
        <label>Pole in qualifica GP (+2):</label>
        <select name="pole{{ i }}">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select><br>

        <label>Giro veloce in gara (+1):</label>
        <input type="checkbox" name="fastest_lap{{ i }}" class="fastest_lap"><br>

        <label>Driver of the Day (+1):</label>
        <input type="checkbox" name="driver_day{{ i }}" class="driver_day"><br>

        <label>Fastest pit-stop (+2):</label>
        <input type="checkbox" name="fastest_pit{{ i }}" class="fastest_pit"><br>

        <label>Parte dalle ultime due file ma va a punti (+2):</label>
        <select name="rimonta{{ i }}">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select><br>

        <label>Posizioni guadagnate (+0,5 per posizione):</label>
        <select name="pos_guadagnate{{ i }}">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select><br>

        <label>Vittoria GP (+3):</label>
        <select name="vittoria{{ i }}">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select><br>

        <label>Podio GP (2°/3° posto) (+2):</label>
        <select name="podio{{ i }}">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select><br>

        <br><hr>
        <h3>Malus</h3>
        <label>Squalifica (-5):</label>
        <select name="squalifica{{ i }}">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select><br>

        <label>DNF (-3):</label>
        <select name="dnf{{ i }}">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select><br>

        <label>Penalità ≥ 6 secondi (-4):</label>
        <select name="pen6{{ i }}">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select><br>

        <label>Penalità ≤ 5 secondi (-3):</label>
        <select name="pen5{{ i }}">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select><br>

        <label>Ultimo in gara (-2):</label>
        <input type="checkbox" name="last_place{{ i }}" class="last_place"><br>

        <label>Non supera il Q1 (-1):</label>
        <select name="q1{{ i }}">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select><br>

        <label>Posizioni perse (-0,5 per posizione):</label>
        <select name="pos_perse{{ i }}">
          <option value="no">No</option>
          <option value="si">Sì</option>
        </select><br>
      </div>
      <br><br>
      {% endfor %}

      <button type="submit" class="btn">Salva risultati</button>
    </form>
  </div>
</body>
</html>
